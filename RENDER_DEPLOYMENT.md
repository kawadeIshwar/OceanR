# OceanR Backend - Render Deployment Guide

This guide provides step-by-step instructions for deploying the OceanR backend API to Render.

## üìã Prerequisites

Before deploying, ensure you have:

- [ ] GitHub repository with your code pushed
- [ ] MongoDB Atlas database set up and running
- [ ] Cloudinary account credentials
- [ ] Gmail account with App Password for email notifications
- [ ] Render account (sign up at https://render.com)

## üöÄ Quick Deploy (Automated)

### Option 1: Using render.yaml (Recommended)

1. **Push render.yaml to GitHub**
   ```bash
   git add render.yaml
   git commit -m "Add Render configuration"
   git push origin main
   ```

2. **Deploy from Render Dashboard**
   - Go to [Render Dashboard](https://dashboard.render.com/)
   - Click **"New +"** ‚Üí **"Blueprint"**
   - Connect your GitHub repository
   - Render will automatically detect `render.yaml`
   - Click **"Apply"**

3. **Add Environment Variables**
   
   After deployment starts, go to your service and add these environment variables:
   
   | Variable Name | Value | Example |
   |--------------|-------|---------|
   | `MONGODB_URI` | Your MongoDB connection string | `mongodb+srv://user:pass@cluster.mongodb.net/oceanr` |
   | `JWT_SECRET` | Auto-generated by Render | (automatically set) |
   | `CLOUDINARY_CLOUD_NAME` | Your Cloudinary cloud name | `duiw1w80v` |
   | `CLOUDINARY_API_KEY` | Your Cloudinary API key | `684457335534412` |
   | `CLOUDINARY_API_SECRET` | Your Cloudinary API secret | `qWIPjUDDX-HGkSYXRYU2q80izck` |
   | `EMAIL_USER` | Your Gmail address | `oceanrenterprises@gmail.com` |
   | `EMAIL_PASS` | Gmail App Password | `your_16_char_app_password` |
   | `EMAIL_FROM` | Sender email address | `oceanrenterprises@gmail.com` |

## üîß Manual Deploy

### Option 2: Manual Web Service Setup

1. **Create New Web Service**
   - Go to [Render Dashboard](https://dashboard.render.com/)
   - Click **"New +"** ‚Üí **"Web Service"**
   - Choose **"Build and deploy from a Git repository"**
   - Click **"Next"**

2. **Connect Repository**
   - Connect your GitHub account
   - Select your repository: `OceanR` or your repo name
   - Click **"Connect"**

3. **Configure Service**
   
   Fill in the following details:
   
   - **Name**: `oceanr-api` (or your preferred name)
   - **Region**: Select closest to your users (e.g., Singapore, Oregon)
   - **Branch**: `main` (or your default branch)
   - **Root Directory**: `server`
   - **Runtime**: `Node`
   - **Build Command**: `npm install`
   - **Start Command**: `npm start`
   - **Plan**: `Free` (or select paid plan for better performance)

4. **Add Environment Variables**
   
   Click **"Advanced"** ‚Üí **"Add Environment Variable"** and add each of these:

   ```
   NODE_ENV=production
   PORT=5000
   MONGODB_URI=<your_mongodb_connection_string>
   JWT_SECRET=<generate_random_32_char_string>
   JWT_EXPIRES_IN=7d
   CLOUDINARY_CLOUD_NAME=<your_cloudinary_name>
   CLOUDINARY_API_KEY=<your_cloudinary_key>
   CLOUDINARY_API_SECRET=<your_cloudinary_secret>
   EMAIL_HOST=smtp.gmail.com
   EMAIL_PORT=587
   EMAIL_USER=<your_gmail_address>
   EMAIL_PASS=<your_gmail_app_password>
   EMAIL_FROM=<your_sender_email>
   ```

5. **Create Web Service**
   - Click **"Create Web Service"**
   - Wait for initial deployment (5-10 minutes)
   - ‚úÖ Your API is live at: `https://oceanr-api.onrender.com`

## üîë Setting Up Required Credentials

### MongoDB Atlas

1. Go to [MongoDB Atlas](https://cloud.mongodb.com/)
2. Navigate to your cluster
3. Click **"Connect"** ‚Üí **"Connect your application"**
4. Copy connection string
5. Replace `<password>` with your database user password
6. Replace database name with `oceanr`

**Example:**
```
mongodb+srv://username:YourPassword123@cluster0.xxxxx.mongodb.net/oceanr?retryWrites=true&w=majority
```

### JWT Secret

Generate a secure random string:

**Option 1 - Using Node.js:**
```javascript
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

**Option 2 - Online Generator:**
- Visit: https://www.random.org/strings/
- Generate 32 character alphanumeric string

**Option 3 - Let Render generate:**
- In Render dashboard, use "Generate Value" button for JWT_SECRET

### Gmail App Password

1. Go to [Google Account](https://myaccount.google.com/)
2. Navigate to **Security** ‚Üí **2-Step Verification** (enable if not already)
3. Scroll to **App passwords**
4. Select **Mail** and your device
5. Click **Generate**
6. Copy the 16-character password (no spaces)
7. Use this as `EMAIL_PASS`

### Cloudinary Credentials

1. Go to [Cloudinary Dashboard](https://console.cloudinary.com/)
2. Find **Account Details** section
3. Copy:
   - Cloud Name
   - API Key  
   - API Secret

## üìä Post-Deployment Steps

### 1. Verify Deployment

Check if your API is running:

```bash
curl https://oceanr-api.onrender.com/api/health
```

Expected response:
```json
{
  "status": "OK",
  "message": "OceanR API is running"
}
```

### 2. Seed Database

You need to seed your database with initial data (categories, admin user).

**Option A - Using Render Shell:**

1. Go to your service in Render Dashboard
2. Click **"Shell"** tab
3. Run:
   ```bash
   cd server
   npm run seed
   ```

**Option B - Run Locally:**

```bash
cd server
MONGODB_URI=<your_production_mongodb_uri> npm run seed
```

### 3. Test Admin Login

1. Open: `https://your-frontend-url.com/admin/login`
2. Login with default credentials:
   - Email: `admin@oceanr.com`
   - Password: `ChangeMe123`
3. **‚ö†Ô∏è IMPORTANT: Change the password immediately!**

### 4. Update Frontend API URL

Update your frontend to use the Render API URL:

In `client/src/utils/api.js`:
```javascript
const api = axios.create({
  baseURL: import.meta.env.VITE_API_URL || 'https://oceanr-api.onrender.com',
  // ... rest of config
});
```

Set environment variable in your frontend hosting (Netlify/Vercel):
```
VITE_API_URL=https://oceanr-api.onrender.com/api
```

## üîÑ Auto-Deploy on Git Push

Render automatically redeploys when you push to your repository:

```bash
git add .
git commit -m "Update backend"
git push origin main
```

Render will:
1. Detect the push
2. Pull latest code
3. Run build command
4. Restart service
5. Monitor health check

## üêõ Troubleshooting

### Deployment Fails

**Problem:** Build fails with "Cannot find module"
- **Solution:** Ensure all dependencies are in `package.json`
- Check that `node_modules` is in `.gitignore`

**Problem:** "ECONNREFUSED" MongoDB error
- **Solution:** Verify `MONGODB_URI` is correct
- Check MongoDB Atlas network access allows all IPs (0.0.0.0/0)
- Ensure database user has correct permissions

### Service Crashes

**Problem:** Service keeps restarting
- **Solution:** Check Render logs (Dashboard ‚Üí Logs tab)
- Verify all environment variables are set
- Check MongoDB connection string

**Problem:** "Module not found" errors
- **Solution:** Ensure `"type": "module"` is in `package.json`
- Check import statements use `.js` extensions

### API Not Responding

**Problem:** 503 Service Unavailable
- **Solution:** Service is starting up (wait 2-3 minutes)
- On free plan, service sleeps after 15 min inactivity

**Problem:** CORS errors from frontend
- **Solution:** Update CORS configuration in `server.js`:
  ```javascript
  app.use(cors({
    origin: ['https://your-frontend-domain.com'],
    credentials: true
  }));
  ```

### Email Not Sending

**Problem:** Password reset emails not working
- **Solution:** Verify Gmail App Password is correct
- Check that 2-Step Verification is enabled on Gmail
- Ensure `EMAIL_USER` matches the Gmail account

## üìà Monitoring & Logs

### View Logs

1. Go to Render Dashboard
2. Select your service
3. Click **"Logs"** tab
4. Filter by date/time or search for errors

### Metrics

- **Events**: Deployment history and health checks
- **Metrics**: CPU, Memory, Network usage (paid plans)

### Set Up Alerts

1. Go to service **Settings**
2. Enable **"Notify on Deploy"**
3. Add email addresses for notifications

## üîí Security Best Practices

1. **Rotate Secrets Regularly**
   - Update JWT_SECRET every 3-6 months
   - Regenerate API keys annually

2. **Monitor Access**
   - Review MongoDB Atlas access logs
   - Check Render logs for suspicious activity

3. **Keep Dependencies Updated**
   ```bash
   npm audit
   npm update
   ```

4. **Enable CORS Properly**
   - Specify exact frontend domains
   - Don't use wildcard (*) in production

## üí∞ Render Free Tier Limits

- **Instance Type**: 0.1 CPU, 512 MB RAM
- **Bandwidth**: 100 GB/month
- **Build Minutes**: 500 minutes/month
- **Auto-sleep**: After 15 minutes of inactivity
- **Spin-up Time**: 30-60 seconds from sleep

**Note:** First request after sleep will be slow. Consider upgrading to paid plan ($7/month) for:
- No auto-sleep
- More resources
- Better performance

## üìû Support

- **Render Docs**: https://render.com/docs
- **Render Community**: https://community.render.com/
- **Status Page**: https://status.render.com/

## ‚úÖ Deployment Checklist

- [ ] GitHub repository pushed
- [ ] MongoDB Atlas configured and accessible
- [ ] Cloudinary credentials obtained
- [ ] Gmail App Password created
- [ ] Render service created
- [ ] All environment variables added
- [ ] Initial deployment successful
- [ ] Health check endpoint responding
- [ ] Database seeded with initial data
- [ ] Admin login tested
- [ ] Frontend connected to backend API
- [ ] CORS configured for frontend domain
- [ ] Monitoring and alerts set up

---

**Your backend is now deployed on Render! üéâ**

**API URL**: `https://oceanr-api.onrender.com`

**Next Steps:**
1. Copy `.env.example` to `.env` in the client folder (if not already done)
2. Ensure VITE_API_URL is set to `https://oceanr-api.onrender.com/api`
3. Test the API health endpoint
4. Seed your database with initial data
5. Deploy your frontend to Netlify/Vercel
